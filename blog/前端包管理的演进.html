<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端包管理器的发展演进 | 进阶</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/myBlog/cc.png">
    <meta name="description" content="学习笔记">
    
    <link rel="preload" href="/myBlog/assets/css/0.styles.4d5c5372.css" as="style"><link rel="preload" href="/myBlog/assets/js/app.940a19a6.js" as="script"><link rel="preload" href="/myBlog/assets/js/3.92f17e55.js" as="script"><link rel="preload" href="/myBlog/assets/js/1.fb090512.js" as="script"><link rel="preload" href="/myBlog/assets/js/9.3f2d5568.js" as="script"><link rel="prefetch" href="/myBlog/assets/js/10.3cd559f0.js"><link rel="prefetch" href="/myBlog/assets/js/11.dba209a7.js"><link rel="prefetch" href="/myBlog/assets/js/12.e667cf24.js"><link rel="prefetch" href="/myBlog/assets/js/13.dcd5e38c.js"><link rel="prefetch" href="/myBlog/assets/js/14.a0972b59.js"><link rel="prefetch" href="/myBlog/assets/js/15.6269d436.js"><link rel="prefetch" href="/myBlog/assets/js/16.be6459c1.js"><link rel="prefetch" href="/myBlog/assets/js/17.80243272.js"><link rel="prefetch" href="/myBlog/assets/js/18.a9e42de3.js"><link rel="prefetch" href="/myBlog/assets/js/19.6e91205d.js"><link rel="prefetch" href="/myBlog/assets/js/20.8f018a53.js"><link rel="prefetch" href="/myBlog/assets/js/21.411c8fec.js"><link rel="prefetch" href="/myBlog/assets/js/22.06836dde.js"><link rel="prefetch" href="/myBlog/assets/js/23.a850ac2d.js"><link rel="prefetch" href="/myBlog/assets/js/24.a6ab77b9.js"><link rel="prefetch" href="/myBlog/assets/js/25.e51c3db5.js"><link rel="prefetch" href="/myBlog/assets/js/26.54424bc6.js"><link rel="prefetch" href="/myBlog/assets/js/27.c0cd6a92.js"><link rel="prefetch" href="/myBlog/assets/js/28.ed41b7c0.js"><link rel="prefetch" href="/myBlog/assets/js/29.a90faddb.js"><link rel="prefetch" href="/myBlog/assets/js/30.93959302.js"><link rel="prefetch" href="/myBlog/assets/js/31.2d69b3bf.js"><link rel="prefetch" href="/myBlog/assets/js/32.8d591d1b.js"><link rel="prefetch" href="/myBlog/assets/js/33.0df8b39c.js"><link rel="prefetch" href="/myBlog/assets/js/34.e9bf4ee2.js"><link rel="prefetch" href="/myBlog/assets/js/35.d9cd3a1e.js"><link rel="prefetch" href="/myBlog/assets/js/36.be1dd74d.js"><link rel="prefetch" href="/myBlog/assets/js/37.dc3b4787.js"><link rel="prefetch" href="/myBlog/assets/js/38.2f517de4.js"><link rel="prefetch" href="/myBlog/assets/js/39.bcc498a9.js"><link rel="prefetch" href="/myBlog/assets/js/4.20d827d9.js"><link rel="prefetch" href="/myBlog/assets/js/40.a2675ec2.js"><link rel="prefetch" href="/myBlog/assets/js/41.49a77ffa.js"><link rel="prefetch" href="/myBlog/assets/js/42.6b5bb905.js"><link rel="prefetch" href="/myBlog/assets/js/43.514eac2c.js"><link rel="prefetch" href="/myBlog/assets/js/44.aeeb8da3.js"><link rel="prefetch" href="/myBlog/assets/js/45.0b6b04ec.js"><link rel="prefetch" href="/myBlog/assets/js/46.f916029d.js"><link rel="prefetch" href="/myBlog/assets/js/47.65530fb7.js"><link rel="prefetch" href="/myBlog/assets/js/48.047367f4.js"><link rel="prefetch" href="/myBlog/assets/js/49.2cf38cf2.js"><link rel="prefetch" href="/myBlog/assets/js/5.3e1da93b.js"><link rel="prefetch" href="/myBlog/assets/js/50.6d32f4c2.js"><link rel="prefetch" href="/myBlog/assets/js/51.93d82dd6.js"><link rel="prefetch" href="/myBlog/assets/js/52.6d48b8e6.js"><link rel="prefetch" href="/myBlog/assets/js/53.2550e734.js"><link rel="prefetch" href="/myBlog/assets/js/54.66c1cfec.js"><link rel="prefetch" href="/myBlog/assets/js/55.46a3f7ab.js"><link rel="prefetch" href="/myBlog/assets/js/56.b557ca7c.js"><link rel="prefetch" href="/myBlog/assets/js/57.ebb555a0.js"><link rel="prefetch" href="/myBlog/assets/js/58.25dec79d.js"><link rel="prefetch" href="/myBlog/assets/js/59.bf876983.js"><link rel="prefetch" href="/myBlog/assets/js/6.be50992c.js"><link rel="prefetch" href="/myBlog/assets/js/60.6200a9fb.js"><link rel="prefetch" href="/myBlog/assets/js/61.ce22748f.js"><link rel="prefetch" href="/myBlog/assets/js/62.103b56df.js"><link rel="prefetch" href="/myBlog/assets/js/63.13ee4c34.js"><link rel="prefetch" href="/myBlog/assets/js/64.d30d815b.js"><link rel="prefetch" href="/myBlog/assets/js/65.bf68d759.js"><link rel="prefetch" href="/myBlog/assets/js/66.737eaca7.js"><link rel="prefetch" href="/myBlog/assets/js/67.bcf6e7e2.js"><link rel="prefetch" href="/myBlog/assets/js/68.3bf6fefd.js"><link rel="prefetch" href="/myBlog/assets/js/69.59977576.js"><link rel="prefetch" href="/myBlog/assets/js/7.1874a01a.js"><link rel="prefetch" href="/myBlog/assets/js/70.33584d1e.js"><link rel="prefetch" href="/myBlog/assets/js/71.a61a1e77.js"><link rel="prefetch" href="/myBlog/assets/js/8.1b7710be.js">
    <link rel="stylesheet" href="/myBlog/assets/css/0.styles.4d5c5372.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-9f1e2f90><div data-v-9f1e2f90><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-9f1e2f90 data-v-9f1e2f90><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-58d5ab76 data-v-9f1e2f90 data-v-9f1e2f90><h3 class="title" style="display:none;" data-v-58d5ab76 data-v-58d5ab76>进阶</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><input type="password" value="" data-v-58d5ab76> <span data-v-58d5ab76>Konck! Knock!</span> <button data-v-58d5ab76>OK</button></label> <div class="footer" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><span data-v-58d5ab76><i class="iconfont reco-theme" data-v-58d5ab76></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-58d5ab76>vuePress-theme-reco</a></span> <span data-v-58d5ab76><i class="iconfont reco-copyright" data-v-58d5ab76></i> <a data-v-58d5ab76><span data-v-58d5ab76>R-Z</span>
            
          <!---->
          2023
        </a></span></div></div> <div class="hide" data-v-9f1e2f90><header class="navbar" data-v-9f1e2f90><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/myBlog/" class="home-link router-link-active"><img src="/myBlog/cc.png" alt="进阶" class="logo"> <span class="site-name">进阶</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/myBlog/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/categories/布局/" class="nav-link"><i class="iconfont undefined"></i>
  布局
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/网络/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/Tools/" class="nav-link"><i class="iconfont undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/tools/" class="nav-link"><i class="iconfont undefined"></i>
  tools
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/工具/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/面试/" class="nav-link"><i class="iconfont undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/智能/" class="nav-link"><i class="iconfont undefined"></i>
  智能
</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/myBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/myBlog/frontend/" class="nav-link"><i class="iconfont undefined"></i>
  前端知识
</a></div><div class="nav-item"><a href="/myBlog/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/myBlog/project/" class="nav-link"><i class="iconfont undefined"></i>
  项目
</a></div><div class="nav-item"><a href="/myBlog/notes/" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></div><div class="nav-item"><a href="/myBlog/blog/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/language/chinese.html" class="nav-link"><i class="iconfont undefined"></i>
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/language/English.html" class="nav-link"><i class="iconfont undefined"></i>
  English
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-9f1e2f90></div> <aside class="sidebar" data-v-9f1e2f90><div class="personal-info-wrapper" data-v-3eba7259 data-v-9f1e2f90><!----> <h3 class="name" data-v-3eba7259>
    R-Z
  </h3> <div class="num" data-v-3eba7259><div data-v-3eba7259><h3 data-v-3eba7259>31</h3> <h6 data-v-3eba7259>Article</h6></div> <div data-v-3eba7259><h3 data-v-3eba7259>17</h3> <h6 data-v-3eba7259>Tag</h6></div></div> <hr data-v-3eba7259></div> <nav class="nav-links"><div class="nav-item"><a href="/myBlog/" class="nav-link"><i class="iconfont undefined"></i>
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/categories/布局/" class="nav-link"><i class="iconfont undefined"></i>
  布局
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/frontEnd/" class="nav-link"><i class="iconfont undefined"></i>
  frontEnd
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/网络/" class="nav-link"><i class="iconfont undefined"></i>
  网络
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/Tools/" class="nav-link"><i class="iconfont undefined"></i>
  Tools
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/tools/" class="nav-link"><i class="iconfont undefined"></i>
  tools
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/工具/" class="nav-link"><i class="iconfont undefined"></i>
  工具
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/面试/" class="nav-link"><i class="iconfont undefined"></i>
  面试
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/categories/智能/" class="nav-link"><i class="iconfont undefined"></i>
  智能
</a></li></ul></div></div><div class="nav-item"><a href="/myBlog/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/myBlog/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><a href="/myBlog/frontend/" class="nav-link"><i class="iconfont undefined"></i>
  前端知识
</a></div><div class="nav-item"><a href="/myBlog/algorithm/" class="nav-link"><i class="iconfont undefined"></i>
  算法
</a></div><div class="nav-item"><a href="/myBlog/project/" class="nav-link"><i class="iconfont undefined"></i>
  项目
</a></div><div class="nav-item"><a href="/myBlog/notes/" class="nav-link"><i class="iconfont undefined"></i>
  笔记
</a></div><div class="nav-item"><a href="/myBlog/blog/" class="nav-link router-link-active"><i class="iconfont undefined"></i>
  文章
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont undefined"></i>
      Languages
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/myBlog/language/chinese.html" class="nav-link"><i class="iconfont undefined"></i>
  Chinese
</a></li><li class="dropdown-item"><!----> <a href="/myBlog/language/English.html" class="nav-link"><i class="iconfont undefined"></i>
  English
</a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/myBlog/blog/" aria-current="page" class="sidebar-link">文章</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-58d5ab76 data-v-9f1e2f90><h3 class="title" style="display:none;" data-v-58d5ab76 data-v-58d5ab76>前端包管理器的发展演进</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><input type="password" value="" data-v-58d5ab76> <span data-v-58d5ab76>Konck! Knock!</span> <button data-v-58d5ab76>OK</button></label> <div class="footer" style="display:none;" data-v-58d5ab76 data-v-58d5ab76><span data-v-58d5ab76><i class="iconfont reco-theme" data-v-58d5ab76></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-58d5ab76>vuePress-theme-reco</a></span> <span data-v-58d5ab76><i class="iconfont reco-copyright" data-v-58d5ab76></i> <a data-v-58d5ab76><span data-v-58d5ab76>R-Z</span>
            
          <!---->
          2023
        </a></span></div></div> <div data-v-9f1e2f90><main class="page"><div class="page-title" style="display:none;"><h1 class="title">前端包管理器的发展演进</h1> <div data-v-42458482><i class="iconfont reco-account" data-v-42458482><span data-v-42458482>R-Z</span></i> <i class="iconfont reco-date" data-v-42458482><span data-v-42458482>2021-09-01</span></i> <!----> <i class="iconfont reco-tag tags" data-v-42458482><span class="tag-item" data-v-42458482>blog</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="包管理器的产生背景"><a href="#包管理器的产生背景" class="header-anchor">#</a> 包管理器的产生背景</h2> <p>包管理器产生之前，前端工程师通常需要单独下载第三方工具库并手动引入，这就存在以下几个问题：</p> <ol><li>工具库会经常更新，每次都要重新下载并替换</li> <li>包引用顺序也必须正确，否则会出现错误</li> <li>工具库较多时难以维护，不符合大型项目的要求</li></ol> <p><img src="/myBlog/assets/img/npm-1.7ab26ec9.png" alt="pic"><br>
如图，BootStrap 依赖于 JQuery ,需要将 BootStrap.js 文件引用放到 JQuery.js 文件之后。</p> <p>正是由于这些问题，就急需包管理工具去代替人工进行依赖管理。</p> <h2 id="包管理器出场"><a href="#包管理器出场" class="header-anchor">#</a> 包管理器出场</h2> <ul><li>npm 和 Bower，npm 只能处理 node 包，Bower 可以处理 HTML 和 CSS 等前端静态资源</li> <li>Bower 版本不匹配问题，CommonJS 和其他模块规范不能很好支持</li> <li>npm V3:提供了一个扁平化的依赖关系树，拥有针对冲突的模块嵌套、CommonJS 模块支持、以及可以同时用于前端包和 node 包的单一生态系统等特性</li></ul> <p>正是由于 npm 功能较为完善，逐渐在社区中火热起来，并继续向前发展。</p> <h2 id="npm-包管理"><a href="#npm-包管理" class="header-anchor">#</a> npm 包管理</h2> <h3 id="npm-介绍"><a href="#npm-介绍" class="header-anchor">#</a> npm 介绍</h3> <p>npm ，是 Node.js 平台的默认包管理工具，通过 npm 可以安装、分发代码，管理项目依赖，随 Node.js 一起安装，npm 的管理思路如下：</p> <ol><li>建立一个代码仓库，其中存放所有需要被共享的代码</li> <li>让 jQuery，BootStrap 作者将代码提交到仓库中</li> <li>当有人需要这些代码时，即可通过 npm 来下载代码，这些代码就被称为包（package）</li></ol> <p><strong>npm 的发展</strong></p> <ul><li>npm 1/2：只能处理 node 包，且安装策略非扁平化，即安装的一个包中，它所依赖的项目都在该文件夹下</li> <li>npm3：目录层级从嵌套变到扁平化，解决目录嵌套层级过深问题，但是安装速度依然较慢</li> <li>npm5：引入 package-lock.json 文件，并自动添加 dependencies，提升安装速度</li> <li>npm6：加入了缓存，并且又进一步提升了安装速度</li></ul> <h3 id="npm-install-过程"><a href="#npm-install-过程" class="header-anchor">#</a> npm install 过程</h3> <p><img src="/myBlog/assets/img/npm-2.11b19075.png" alt="pic"></p> <ol><li>检查配置（.npmrc文件），从 package.json 中读取所有依赖信息，然后与 node_modules 中已经安装的依赖对比</li> <li>若没有则通过 package-lock.json 获取版本号下载安装，若已存在也会通过 package.lock.json 检查更新，构建依赖树</li> <li>检查缓存，下载包</li> <li>解压到 node_modules 文件，并生成 lock 文件</li></ol> <h3 id="npm-开发文件"><a href="#npm-开发文件" class="header-anchor">#</a> npm 开发文件</h3> <p><strong>package.json</strong></p> <ul><li><code>npm init</code>时生成，记录项目中需要的所有模块，模块名称和大版本信息</li> <li>npm install 时 node 从中读取所有 dependencies 信息，然后与 node_modules 中模块对比</li> <li>没有的直接下载，已有的检查更新</li> <li>只记录安装的模块信息，而模块依赖的其他子模块的信息不会记录</li></ul> <p><strong>package-lock.json</strong></p> <ul><li>记录模块的详细信息，所有模块的具体版本号，包括主模块和所有依赖子模块</li> <li>npm install 时从 package.json 中读取模块名称，从 pakage-lock.json 文件中获取版本号</li> <li>需要上传到 git，确保大家使用的包版本一致</li></ul> <p><strong>文件中 ^ 与 ~ 的含义</strong></p> <ul><li>更新范围：package.json 中所容纳的版本，<code>^</code>即表示兼容该版本之后的小版本而不更新大版本</li> <li>如：<code>&quot;vue&quot;: &quot;^2.5.2&quot;</code>指范围应该 &gt;= 2.52 但 &lt; 3.0.0之间，另外<code>^</code>会忽略版本号开头为0的数字，<code>^0.12</code>表示 &gt;= 0.12 并 &lt; 0.20</li> <li>~ 表示更新到当前 minor version（即中间那个数字中的最新版本），如 ~1.15.2表示  &gt;= 1.15.2 &lt; 1.16.0</li></ul> <p><strong>package.json 中 dependencies 和 devDependencies 区别</strong></p> <ul><li>dependencies 是生产环境需要的依赖，如 vue，axios 等，通过<code>--save</code>方式保存其中</li> <li>devDependencies 是开发环境所需要的依赖如 webpack，babel 等，只存在于开发阶段，打包后不会用到，通过<code>--save-dev</code>保存其中</li> <li>因此在浏览或者使用其他人项目时我们可以选择性地安装依赖来节省时间</li> <li><code>npm install</code>是全部安装，<code>npm install --production</code>则只安装dependencies下的依赖</li> <li>另，<code>-g</code>是指全局环境安装，所有的项目都可以使用</li></ul> <p>前面提到，npm 3 变成了扁平式的依赖结构，解决了很多问题，达到可用的程度。但是，依然有很多痛点，比如安装速度依然较慢，同时无法保证两次安装的版本完全相同，可能出现很多错误。
另外，它也不支持缓存和离线模式，正是由于这些问题，Facebook 和 Google 共同推行 yarn，旨在打造一个更优秀、完善的包管理工具。</p> <h2 id="yarn"><a href="#yarn" class="header-anchor">#</a> yarn</h2> <h3 id="yarn-介绍"><a href="#yarn-介绍" class="header-anchor">#</a> yarn 介绍</h3> <p>yarn，由 Facebook 推出的包管理工具，其特点如下：</p> <ul><li>快 — yarn 充分利用缓存，加载过的包会被放进缓存内，再次加载相同包时会优先读取缓存，另外多个包下载和安装并行</li> <li>可靠 — 生成 yarn 项目时会生成一个 yarn.lock 文件，用于锁定安装包版本号</li> <li>安全 — 执行代码前，yarn 会通过算法校验每个安装包的完整性</li> <li>可迁移 — 同格式的 package.json，npm 项目和 yarn 项目可以无缝切换</li></ul> <h3 id="pnp-模式"><a href="#pnp-模式" class="header-anchor">#</a> PnP 模式</h3> <ul><li>用于取代 node_modules，生成一个 .pnp.js 文件去告诉 nodejs 包的具体位置，而不是在 node_modules 中寻找依赖</li> <li>把所有包以 zip 的格式存储，甚至让不同的工程共用同一份依赖文件，减少依赖的体积和加载时间</li> <li>yarn 1可以使用 pnp，但是 yarn 2默认开启了它</li></ul> <h3 id="npm-和-yarn-的区别"><a href="#npm-和-yarn-的区别" class="header-anchor">#</a> npm 和 yarn 的区别</h3> <p><strong>yarn 的优点</strong></p> <ul><li>速度快：并行安装 package，并拥有离线模式，即如果之前安装过一个软件包，可从缓存中获取</li> <li>更简洁的输出：较 npm 的输出信息简洁很多，直接打印出必要的信息</li> <li>多注册来源处理：所有依赖包，不管被关联引用多少次，只会从一个注册来源安装，防止混乱</li> <li>更好的语义化：使用 yarn add/remove，比 install/uninstall 更清晰一些</li></ul> <p><strong>npm 5 的改进</strong></p> <ul><li>默认增加了类似 yarn.lock 的 package-lock.json</li> <li>文件依赖优化：之前安装时会将文件目录拷贝到 node_modules 中，npm5 使用创建 symlinks（软链接） 的方式实现，不再拷贝</li> <li>大幅度提升了安装速度，目前在一些场景中可以赶上 yarn</li></ul> <p><strong>npm 6 的改进</strong></p> <ul><li>加入了缓存，并提高了安全性和性能</li></ul> <p><strong>npm 和 yarn 常用命令对比</strong></p> <table><thead><tr><th style="text-align:left;">npm</th> <th style="text-align:left;">yarn</th></tr></thead> <tbody><tr><td style="text-align:left;">npm install</td> <td style="text-align:left;">yarn install</td></tr> <tr><td style="text-align:left;">npm install [package] --save-dev</td> <td style="text-align:left;">yarn add [package] -dev</td></tr> <tr><td style="text-align:left;">npm install [package] -g</td> <td style="text-align:left;">yarn global add [package]</td></tr> <tr><td style="text-align:left;">npm update -g</td> <td style="text-align:left;">yarn global upgrade</td></tr> <tr><td style="text-align:left;">npm uninstall [package]</td> <td style="text-align:left;">yarn remove [package]</td></tr></tbody></table> <h2 id="pnpm-performant-npm"><a href="#pnpm-performant-npm" class="header-anchor">#</a> pnpm（performant npm）</h2> <h3 id="pnpm-优点"><a href="#pnpm-优点" class="header-anchor">#</a> pnpm 优点</h3> <ul><li>速度极快</li> <li>高效利用磁盘空间，基于内容寻址</li> <li>不会重复安装同一个包</li> <li>支持monorepo</li> <li>安全性高：自创了一套依赖管理方式，解决依赖间非法访问的问题</li></ul> <p><img src="/myBlog/assets/img/npm-3.b69b19f0.png" alt="pic">
如图，黄色的是pnpm，在安装react包时，绝大多数场景下，速度明显优于npm/yarn，有些甚至快2-3倍</p> <h3 id="monorepo-简介"><a href="#monorepo-简介" class="header-anchor">#</a> monorepo 简介</h3> <p><img src="/myBlog/assets/img/npm-4.09fac0e2.png" alt="pic"></p> <ul><li>传统模式中每个项目对应一个单独的仓库来分散管理</li> <li>monorepo 指多个项目放在一个仓库中</li> <li>优点：代码复用、无需切换开发环境、方便团队协作等</li></ul> <h3 id="node-modules-依赖管理"><a href="#node-modules-依赖管理" class="header-anchor">#</a> node_modules 依赖管理</h3> <p><strong>npm1 和 npm2 时的结构：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>node_modules
└─ foo
   ├─ index<span class="token punctuation">.</span>js
   ├─ <span class="token keyword">package</span><span class="token punctuation">.</span>json
   └─ node_modules
      └─ bar
         ├─ index<span class="token punctuation">.</span>js
         └─ <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><p><strong>后续的扁平化依赖结构：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>node_modules
├─ foo
<span class="token operator">|</span>  ├─ index<span class="token punctuation">.</span>js
<span class="token operator">|</span>  └─ <span class="token keyword">package</span><span class="token punctuation">.</span>json
└─ bar
   ├─ index<span class="token punctuation">.</span>js
   └─ <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre></div><ul><li>不再有很深层次的嵌套关系</li> <li>找到相同版本包时就不会重复安装，且依赖层级不会太深</li> <li>扁平化之后，依赖结构会存在不确定性，因此需要lock文件</li></ul> <p><strong>pnpm 依赖结构</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>▾ node_modules
  ▾ <span class="token punctuation">.</span>pnpm
    ▸ accepts@<span class="token number">1.3</span><span class="token number">.7</span>
    ▸ array<span class="token operator">-</span>flatten@<span class="token number">1.1</span><span class="token number">.1</span>
    <span class="token operator">...</span>
    ▾ express@<span class="token number">4.17</span><span class="token number">.1</span>
      ▾ node_modules
        ▸ accepts  <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>accepts@<span class="token number">1.3</span><span class="token number">.7</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>accepts
        ▸ array<span class="token operator">-</span>flatten <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>array<span class="token operator">-</span>flatten@<span class="token number">1.1</span><span class="token number">.1</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>array<span class="token operator">-</span>flatten
        <span class="token operator">...</span>
        ▾ express
          ▸ lib
            History<span class="token punctuation">.</span>md
            index<span class="token punctuation">.</span>js
            <span class="token constant">LICENSE</span>
            <span class="token keyword">package</span><span class="token punctuation">.</span>json
            Readme<span class="token punctuation">.</span>md
</code></pre></div><ul><li>扁平 + 嵌套软链接结构：将包本身和依赖放在同一个 node_module 下面</li> <li>与 package.json 声明的依赖基本保持一致</li></ul> <h3 id="pnpm-原理"><a href="#pnpm-原理" class="header-anchor">#</a> pnpm 原理</h3> <p>pnpm 使用软链接和硬链接来共同构建 node_modules 目录
假设有两个包 a 和 b，a 依赖于 b，则安装依赖 a 时，pnpm 处理如下：
<img src="/myBlog/assets/img/npm-5.2b28eec9.png" alt="pic"></p> <ol><li>查询依赖关系，得到最终要安装的包： a 和 b</li> <li>查看 a 和 b是否有缓存，如果没有，则下载到缓存中，否则进入下一步</li> <li>创建 node_modules 目录，并对目录结构进行初始化</li> <li>从缓存的对应包中使用硬链接放置文件到相应包代码目录中</li> <li>使用符号链接，将每个包的直接依赖放置到自己的目录中，从而保证 a 的代码在执行时能读取直接依赖</li> <li>新版本的 pnpm 为了解决读取间接依赖的问题，将所有的工程非直接依赖，使用符号链接加入到了 .pnpm/node_modules 中</li> <li>在工程的 node_modules 目录中使用符号链接，放置直接依赖</li></ol> <h3 id="pnpm-的使用"><a href="#pnpm-的使用" class="header-anchor">#</a> pnpm 的使用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 安装 axios</span>
pnpm install axios
<span class="token comment">// 安装 axios 并将 axios 添加至 devDependencies</span>
pnpm install axios <span class="token operator">-</span><span class="token constant">D</span>
<span class="token comment">// 安装 axios 并将 axios 添加至 dependencies</span>
pnpm install axios <span class="token operator">-</span><span class="token constant">S</span>

<span class="token comment">// 更新axios</span>
pnpm update axios

<span class="token comment">// 通过 --filter来指定package</span>
pnpm install axios <span class="token operator">--</span>filter <span class="token number">0.18</span>

<span class="token comment">// 链接到另一项目，使用硬链接</span>
pnpm link <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>axios
</code></pre></div><p>项目开发中，常用的开发命令如 run/start/test 等使用和 npm 使用相同</p> <h2 id="包管理器总结"><a href="#包管理器总结" class="header-anchor">#</a> 包管理器总结</h2> <h3 id="演进小结"><a href="#演进小结" class="header-anchor">#</a> 演进小结</h3> <ul><li>npm 1/2：包管理器的开始，处理 node 包，管理依赖</li> <li>npm 3： 扁平化依赖结构，修复大量问题</li> <li>yarn：更快速，解决包版本依赖问题，更好用</li> <li>npm 5：引入 package-lock.json 文件，提升性能，吸收 yarn 优点</li> <li>pnpm：快速安全，节省空间，自创依赖管理结构</li></ul> <h3 id="包管理器的未来"><a href="#包管理器的未来" class="header-anchor">#</a> 包管理器的未来</h3> <ul><li>npm 7：支持 workspaces，可支持从单个顶级软件包中管理多个软件包。自动安装 peerDependencies</li> <li>yarn 2：pnp 模式 - 取代 node_modules ，减少依赖的体积和加载时间，大幅提升速度，解决已有问题</li> <li>pnpm：速度快，依赖管理出色，对 monorepo 支持良好，日趋成熟</li></ul> <p>随着包管理器的发展，他们的功能越来越强大，性能提升，也解决了很多痛点，未来可以多去实践这些不同的工具，根据项目和实际需求确定我们所需的工具。</p> <h2 id="参考资料"><a href="#参考资料" class="header-anchor">#</a> 参考资料</h2> <ul><li><a href="https://juejin.cn/post/6844903489726840839#heading-1" target="_blank" rel="noopener noreferrer">JavaScript 包管理的前世今生<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903910482657294#heading-12" target="_blank" rel="noopener noreferrer">新一代 javascript 包管理工具：YARN 简介<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6932046455733485575#heading-3" target="_blank" rel="noopener noreferrer">关于现代包管理器的深度思考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://classic.yarnpkg.com/en/docs" target="_blank" rel="noopener noreferrer">yarn 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://pnpm.js.org/en/" target="_blank" rel="noopener noreferrer">pnpm 官方文档<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://cloud.tencent.com/developer/article/1555982" target="_blank" rel="noopener noreferrer">Conarli《npm install 原理分析》<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://zhuanlan.zhihu.com/p/362228487" target="_blank" rel="noopener noreferrer">为什么现代前端工程越来越离不开 Monorepo?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://juejin.cn/post/6844903601563762702#heading-4" target="_blank" rel="noopener noreferrer">为什么我从 npm 到 yarn 再到 npm?<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://ocavue.com/yarn-2-first-impression-zh/#plug-n-play" target="_blank" rel="noopener noreferrer">Yarn 2使用体验<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://www.codenong.com/cs106973810/" target="_blank" rel="noopener noreferrer">pnpm 的原理<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div> <footer class="page-edit" style="display:none;"><!----> <!----></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/myBlog/assets/js/app.940a19a6.js" defer></script><script src="/myBlog/assets/js/3.92f17e55.js" defer></script><script src="/myBlog/assets/js/1.fb090512.js" defer></script><script src="/myBlog/assets/js/9.3f2d5568.js" defer></script>
  </body>
</html>
